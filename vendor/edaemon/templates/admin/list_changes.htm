{% extends 'layout.htm' %}

{% block title %}Izmaiņu skatīšana{% endblock %}

{% block body %}
    <h1>Visas izmaiņas</h1>
    {% if changes | length > 0 %}
    <p>
        <button id="js__purge" class="btn btn-danger">
            <span class="glyphicon glyphicon-trash"></span>
            Satīrīt novecojušās izmaiņas
        </button>
    </p>
    {% endif %}
    <ul>
        {% for change in changes %}
            <li style="padding: 0.5rem;">
                <a href="{{ url_for('main.show_change', change_id=change.key.urlsafe()) }}">
                    klase: {{ change.className }} datums: {{ change.date }}
                </a>
                <a href="{{ url_for('.delete_change', change_id=change.key.urlsafe()) }}" class="btn btn-danger">
                    <span class="glyphicon glyphicon-trash"></span> Izdzēst
                </a>
                <a href="{{ url_for('.modify_change', change_id=change.key.urlsafe()) }}" class="btn btn-default">
                    <span class="glyphicon glyphicon-pencil"></span> Rediģēt
                </a>
            </li>
        {% else %}
            Neatradu!
        {% endfor %}
    </ul>
{% endblock %}

{% if changes | length > 0 %}
{% block scripts %}
{{ super() }}
<script>
    $(function() {
        $('#js__purge').click(function() {
            $('#js__purge').prop('disabled', 'disabled')
                            .text('Notiek satīrīšana, lūdzu uzgaidiet...');
            $.post("{{ url_for('.cleanup_changes') }}", function(data) {
                var parent = $('#js__purge').parent();
                $('#js__purge').remove();
                var alert = $('<div>');
                alert.addClass('alert');
                if (data.ok === true) {
                    alert.addClass('alert-success');
                    alert.text('Satīrīšana darīta!');
                    window.location.reload();
                } else {
                    alert.addClass('alert-danger');
                    alert.text('Satīrīšana neizdevās.');
                }
                parent.append(alert);
            });
        });
    });
</script>
{% endblock %}
{% endif %}
